# Chief Configuration Reference
# =============================
#
# Chief uses a multi-suite format with [[suites]] entries.
# Define multiple suites for multi-language projects (monorepos).
#
# REQUIRED FIELDS
# ---------------
# name            Unique identifier for the suite (e.g., "backend", "frontend")
# language        Programming language (e.g., "Python", "TypeScript", "Go")
# framework       Test framework (e.g., "pytest", "Jest", "go test")
# root            Path prefix for matching files to this suite. Files under this path
#                 belong to this suite. Also used with strip_root_from_target to trim
#                 paths before passing to {target}. Use "." for project root.
#                 NOTE: Commands always run from project root, not from this directory.
# command         Test command. Use {target} placeholder for test file/path
# target_type     How tests are organized: "file", "package", "project", or "repo"
#
# OPTIONAL FIELDS
# ---------------
# default_target  Fallback target when none detected (e.g., ".", "tests/")
# file_patterns   Glob patterns matching test files (e.g., ["test_*.py", "*_test.py"])
# disallow_write_globs
#                 Patterns for files Claude cannot modify during GREEN phase
#                 Use to protect test files from being changed during implementation
#
# init            Command to initialize dev environment (runs if validation fails)
#                 Use for: creating virtualenvs, npm install, installing dependencies
#                 Example: "python -m venv .venv && pip install -r requirements.txt"
#
# setup           Command to run once before suite's tests execute
#                 Use for: starting Docker services, seeding test data
#                 Example: "docker compose up -d"
#
# env             Environment variables for init, setup, and command
#                 Example: { PYENV_VERSION = "3.11", NODE_ENV = "test" }
#
# strip_root_from_target
#                 When true (default), strips `root` prefix from {target} paths.
#                 Example: root="backend/", target="backend/tests/test_foo.py"
#                   -> {target} becomes "tests/test_foo.py"
#                 Set false if your test command expects full paths from project root.
#
# NOTES
# -----
# - Commands run from project root. Avoid `cd` into subdirs or {target} paths break.
# - Use full paths from project root in commands.


# ============================================================
# Python + pytest
# ============================================================

# [[suites]]
# name = "backend"
# language = "Python"
# framework = "pytest"
# root = "."
# command = "pytest {target} -v"
# init = "python -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt"
# default_target = "."
# target_type = "file"
# file_patterns = ["test_*.py", "*_test.py"]
# disallow_write_globs = ["tests/**", "test_*.py", "*_test.py"]


# ============================================================
# Python + pytest (with pyenv for version pinning)
# ============================================================

# [[suites]]
# name = "backend"
# language = "Python"
# framework = "pytest"
# root = "backend/"
# command = "source backend/.venv/bin/activate && pytest {target} -v"
# init = "cd backend && PYENV_VERSION=3.11 python -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt"
# default_target = "tests/"
# target_type = "file"
# file_patterns = ["test_*.py", "*_test.py"]
# disallow_write_globs = ["backend/tests/**", "backend/**/test_*.py"]
# env = { PYENV_VERSION = "3.11" }


# ============================================================
# Python + unittest
# ============================================================

# [[suites]]
# name = "backend"
# language = "Python"
# framework = "unittest"
# root = "."
# command = "python -m unittest {target}"
# default_target = "tests"
# target_type = "file"
# file_patterns = ["test_*.py", "*_test.py"]
# disallow_write_globs = ["tests/**"]


# ============================================================
# TypeScript + Jest
# ============================================================

# [[suites]]
# name = "frontend"
# language = "TypeScript"
# framework = "Jest"
# root = "."
# command = "npx jest {target}"
# init = "npm install"
# default_target = "."
# target_type = "file"
# file_patterns = ["*.test.ts", "*.spec.ts"]
# disallow_write_globs = ["**/*.test.ts", "**/*.spec.ts", "__tests__/**"]


# ============================================================
# TypeScript + Vitest
# ============================================================

# [[suites]]
# name = "frontend"
# language = "TypeScript"
# framework = "Vitest"
# root = "."
# command = "npx vitest run {target}"
# init = "npm install"
# default_target = "."
# target_type = "file"
# file_patterns = ["*.test.ts", "*.spec.ts"]
# disallow_write_globs = ["**/*.test.ts", "**/*.spec.ts"]


# ============================================================
# Go + go test
# ============================================================

# [[suites]]
# name = "backend"
# language = "Go"
# framework = "go test"
# root = "."
# command = "go test -v {target}"
# default_target = "./..."
# target_type = "package"
# file_patterns = ["*_test.go"]
# disallow_write_globs = ["**/*_test.go"]


# ============================================================
# Rust + cargo test
# ============================================================

# [[suites]]
# name = "backend"
# language = "Rust"
# framework = "cargo test"
# root = "."
# command = "cargo test"
# default_target = "."
# target_type = "project"
# file_patterns = []
# disallow_write_globs = ["tests/**"]


# ============================================================
# Ruby + RSpec
# ============================================================

# [[suites]]
# name = "backend"
# language = "Ruby"
# framework = "RSpec"
# root = "."
# command = "bundle exec rspec {target}"
# init = "bundle install"
# default_target = "spec"
# target_type = "file"
# file_patterns = ["*_spec.rb"]
# disallow_write_globs = ["spec/**"]


# ============================================================
# Java + JUnit (Maven)
# ============================================================

# [[suites]]
# name = "backend"
# language = "Java"
# framework = "JUnit"
# root = "."
# command = "mvn test"
# default_target = "."
# target_type = "project"
# file_patterns = ["*Test.java", "Test*.java"]
# disallow_write_globs = ["src/test/**"]


# ============================================================
# JavaScript + Jest (monorepo)
# ============================================================

# [[suites]]
# name = "frontend"
# language = "JavaScript"
# framework = "Jest"
# root = "."
# command = "npx jest --projects {target}"
# init = "npm install"
# default_target = "packages/*"
# target_type = "project"
# file_patterns = ["*.test.js", "*.spec.js"]
# disallow_write_globs = ["**/*.test.js", "**/*.spec.js", "**/__tests__/**"]


# ============================================================
# Multi-Suite: Full-stack (Python + TypeScript)
# ============================================================

# [[suites]]
# name = "backend"
# language = "Python"
# framework = "pytest"
# root = "backend/"
# command = "source backend/.venv/bin/activate && pytest {target} -v"
# init = "cd backend && python -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt"
# default_target = "tests/"
# target_type = "file"
# file_patterns = ["test_*.py", "*_test.py"]
# disallow_write_globs = ["backend/tests/**", "backend/**/test_*.py"]
#
# [[suites]]
# name = "frontend"
# language = "TypeScript"
# framework = "Vitest"
# root = "frontend/"
# command = "npm run test --prefix frontend -- {target}"
# init = "cd frontend && npm install"
# default_target = "src/"
# target_type = "file"
# file_patterns = ["*.test.ts", "*.spec.ts"]
# disallow_write_globs = ["frontend/**/*.test.ts", "frontend/**/*.spec.ts"]


# ============================================================
# Multi-Suite with Docker Build (projects deployed via Docker)
# ============================================================
# When deploying via Docker, add "docker compose build <service>" to catch
# build-time errors (TypeScript strict mode, etc.) that local tests may miss.

# [[suites]]
# name = "backend"
# language = "Python"
# framework = "pytest"
# root = "backend/"
# command = "source backend/.venv/bin/activate && pytest {target} -v && docker compose build sb-backend"
# init = "cd backend && python -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt"
# default_target = "tests/"
# target_type = "file"
# file_patterns = ["test_*.py", "*_test.py"]
# disallow_write_globs = ["backend/tests/**", "backend/**/test_*.py"]
#
# [[suites]]
# name = "frontend"
# language = "TypeScript"
# framework = "Vitest"
# root = "frontend/"
# command = "npm run test --prefix frontend -- {target} && docker compose build sb-frontend"
# init = "cd frontend && npm install"
# default_target = "src/"
# target_type = "file"
# file_patterns = ["*.test.ts", "*.spec.ts"]
# disallow_write_globs = ["frontend/**/*.test.ts", "frontend/**/*.spec.ts"]
